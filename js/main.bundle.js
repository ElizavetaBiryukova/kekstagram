(()=>{var e={624:()=>{const e=["jpg","jpeg","png"],t=document.querySelector("#upload-file"),r=document.querySelector(".img-upload__preview img"),n=document.querySelectorAll(".effects__preview");t.addEventListener("change",(()=>{const o=t.files[0],c=o.name.toLowerCase();if(e.some((e=>c.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{r.src=e.result,n.forEach((t=>{t.style.backgroundImage=`url(${e.result})`}))})),e.readAsDataURL(o)}}))}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,r),c.exports}(()=>{"use strict";const e="Escape",t="Esc",n=document.querySelector(".big-picture"),o=document.querySelector("body"),c=n.querySelector(".big-picture__cancel"),s=document.querySelector(".social__comment-count"),l=document.querySelector(".comments-loader"),i=document.querySelector(".social__comments"),a=document.querySelector("#comment").content.querySelector(".social__comment");let d=[],u=5;const m=()=>{n.classList.add("hidden"),o.classList.remove("modal-open"),c.addEventListener("click",m),i.innerHTML="",u=5,d=[]},v=e=>{u=e.length<5?e.length:u,d=e.slice(0,u),i.innerHTML="",s.textContent=`${d.length} из ${e.length} комментариев`;let t=document.createDocumentFragment();d.forEach((e=>{t.appendChild((e=>{const t=a.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__text").textContent=e.message,t})(e))})),i.appendChild(t),e.length>5&&d.length<e.length?(l.classList.remove("hidden"),l.addEventListener("click",(()=>{v(e)}),{once:!0})):l.classList.add("hidden"),u+=5},p=document.querySelector(".scale__control--smaller"),y=document.querySelector(".scale__control--bigger"),E=document.querySelector(".scale__control--value"),_=document.querySelector(".img-upload__preview img"),g=e=>{E.value=e+"%",_.style.transform=`scale(${e/100})`};p.addEventListener("click",(()=>{let e=parseInt(E.value,10)-5;e<0&&(e=0),g(e)})),y.addEventListener("click",(()=>{let e=parseInt(E.value,10)+5;e>100&&(e=100),g(e)}));const L={CHROME:{MIN:0,MAX:1,STEP:.1,START:1,FILTER:"grayscale",EFFECT:"effects__preview--chrome"},SEPIA:{MIN:0,MAX:1,STEP:.1,START:1,FILTER:"sepia",EFFECT:"effects__preview--sepia"},MARVIN:{MIN:0,MAX:100,STEP:1,START:100,FILTER:"invert",EFFECT:"effects__preview--marvin",NAME:"marvin"},PHOBOS:{MIN:0,MAX:3,STEP:.1,START:3,FILTER:"blur",EFFECT:"effects__preview--phobos",NAME:"phobos"},HEAT:{MIN:1,MAX:3,STEP:.1,START:3,FILTER:"brightness",EFFECT:"effects__preview--heat"},NONE:{MIN:0,MAX:.1,STEP:0,START:0,FILTER:"none",EFFECT:"effects__preview--none"}},S=document.querySelector(".img-upload__effect-level"),f=document.querySelector(".effect-level__value"),h=document.querySelector(".effect-level__slider"),T=document.querySelector(".img-upload__effects"),q=()=>{_.style.filter=L.NONE.FILTER,_.classList.remove(_.classList[0]),_.classList.add(L.NONE.EFFECT),S.classList.add("visually-hidden")};q(),noUiSlider.create(h,{range:{min:0,max:100},behaviour:"snap",connect:[!0,!1],start:80,step:1}),T.addEventListener("change",(e=>{_.classList.remove(_.classList[0]);const t=L[e.target.value.toUpperCase()];_.classList.add(t.EFFECT),e.target.value===L.NONE.FILTER?S.classList.add("visually-hidden"):S.classList.remove("visually-hidden"),h.noUiSlider.updateOptions({range:{min:t.MIN,max:t.MAX},start:t.START,step:t.STEP,format:{to:function(e){return Number.isInteger(e)?e.toFixed(0):e.toFixed(1)},from:function(e){return parseFloat(e)}}}),h.noUiSlider.on("update",((r,n)=>{if(f.value=r[n],e.target.value===L.NONE.FILTER)_.style.filter=L.NONE.FILTER;else{let r="";switch(e.target.value){case L.MARVIN.NAME:r="%";break;case L.PHOBOS.NAME:r="px"}_.style.filter=`${t.FILTER}(${f.value}${r})`}}))}));const k=document.querySelector(".img-upload__overlay"),C=document.querySelector("#upload-file"),F=document.querySelector("#upload-cancel");C.addEventListener("change",(()=>{k.classList.remove("hidden"),o.classList.add("modal-open")}));const N=()=>{E.value="100%",_.style.transform="scale(1.00)",q()},w=()=>{k.classList.add("hidden"),o.classList.remove("modal-open"),C.value=""};F.addEventListener("click",(()=>{w(),N()})),document.addEventListener("keydown",(r=>{r.key!==e&&r.key!==t||(w(),N())}));const A=/^[а-яА-ЯёЁa-zA-Z0-9]+$/,I=document.querySelector(".text__hashtags"),M=document.querySelector(".text__description");I.addEventListener("input",(()=>{I.setCustomValidity("");let e=I.value.toLowerCase().trim();if(!e)return;const t=e.split(" ");if(0===t.length)return;t.forEach((e=>{"#"!==e[0]&&I.setCustomValidity("Хеш-тег должен начинаться с #"),-1==e.slice(1).search(A)&&I.setCustomValidity("Строка после решётки должна состоять из букв и чисел, перед # стоять пробел"),"#"==e&&I.setCustomValidity("Хеш-тег не может состоять только из одной решётки"),e.length>20&&I.setCustomValidity("Максимальная длина хештега 20 символов")})),t.length>5&&I.setCustomValidity("Нельзя указывать больше 5 хеш-тегов");const r=t.reduce(((e,t)=>(e[t]=e[t]?e[t]+1:1,e)),{});Object.values(r)[0]>1&&I.setCustomValidity("Один и тот же хеш-тег не может быть использован дважды")})),M.addEventListener("input",(()=>{M.value.length>140?M.setCustomValidity("Длинна комментария не может составлять больше 140 символов"):M.setCustomValidity("")}));const x=r=>{r.key!==e&&r.key!==t||(r.preventDefault(),r.stopPropagation())};I.addEventListener("keydown",x),M.addEventListener("keydown",x);const b={GET:"https://22.javascript.pages.academy/kekstagram/data",POST:"https://22.javascript.pages.academy/kekstagram"},R=(e,t,r,n)=>{fetch(b[r],{method:r,body:n}).then((e=>e.json())).then((t=>{e(t)})).catch((()=>{t()}))},O=document.querySelector(".img-upload__form"),P=document.querySelector("#error").content,V=document.querySelector("#success").content,D=document.querySelector("main"),$=r=>{const n=D.querySelector(".success");r.preventDefault(),r.key!==e&&r.key!==t||n.remove(),document.removeEventListener("keydown",$),document.removeEventListener("click",X)},X=()=>{D.querySelector(".success").remove(),document.removeEventListener("click",X),document.removeEventListener("keydown",$)},j=r=>{const n=D.querySelector(".error");r.preventDefault(),r.key!==e&&r.key!==t||n.remove(),document.removeEventListener("keydown",j),document.removeEventListener("click",H)},H=()=>{D.querySelector(".error").remove(),document.removeEventListener("click",H),document.removeEventListener("keydown",j)},U=()=>{w(),N(),(()=>{const e=V.cloneNode(!0);document.addEventListener("keydown",$),document.addEventListener("click",X),D.appendChild(e)})()},z=()=>{w(),N(),(()=>{const e=P.cloneNode(!0);document.addEventListener("keydown",j),document.addEventListener("click",H),D.appendChild(e)})()};O.addEventListener("submit",(e=>{e.preventDefault(),R(U,z,O.method.toUpperCase(),new FormData(O))}));const B=document.querySelector(".pictures"),G=document.querySelector("#picture").content.querySelector(".picture"),W=e=>{const t=document.createDocumentFragment();e.forEach((e=>{t.appendChild((e=>{const t=G.cloneNode(!0);return t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__likes").textContent=e.likes,t.querySelector(".picture__comments").textContent=e.comments.length,t.addEventListener("click",(t=>{t.preventDefault(),(e=>{u=5,d=[],o.classList.add("modal-open"),n.querySelector(".big-picture__img img").src=e.url,n.querySelector(".likes-count").textContent=e.likes,n.querySelector(".social__caption").textContent=e.description,c.addEventListener("click",m),n.classList.remove("hidden"),v(e.comments.slice())})(e)})),t})(e))})),B.appendChild(t)},Z=document.querySelector(".img-filters");let J=[];const K={"filter-default":()=>{W(J.slice(0,25))},"filter-random":()=>{W((e=>{for(var t,r,n=e.length;0!==n;)r=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[r],e[r]=t;return e})(J.slice()).slice(0,10))},"filter-discussed":()=>{W(J.slice().sort(((e,t)=>t.comments.length-e.comments.length)))}},Q=(e=>{let t=null;return(...e)=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{(e=>{e.target.classList.contains("img-filters__button")&&(document.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),(()=>{const e=document.querySelectorAll(".picture");e&&e.forEach((e=>{e.remove()}))})(),e.target.classList.add("img-filters__button--active"),K[e.target.id]())})(...e)}),500)}})();Z.addEventListener("click",Q),r(624),R((e=>{Z.classList.remove("img-filters--inactive"),J=e.slice(),W(J.slice(0,25))}),(()=>{(e=>{const t=document.createElement("div");t.style.zIndex="1000",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.right="0",t.style.padding="25px 3px",t.style.fontSize="35px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Не удалось получить данные c сервера. Попробуйте позже.",document.body.append(t),setTimeout((()=>{t.remove()}),6e3)})()}),"GET")})()})();
//# sourceMappingURL=main.bundle.js.map